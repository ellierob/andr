(function(l,k){"function"==typeof define&&define.amd?define(["./rangy-core"],l):"undefined"!=typeof module&&"object"==typeof exports?module.exports=l(require("rangy")):l(k.rangy)})(function(l){l.createModule("ClassApplier",["WrappedSelection"],function(k,l){function z(a,b){for(var c in a)if(a.hasOwnProperty(c)&&!1===b(c,a[c]))return!1;return!0}function I(a,b){return!!a&&(new RegExp("(?:^|\\s)"+b+"(?:\\s|$)")).test(a)}function J(a,b){if("object"==typeof a.classList){for(var c=b.split(/\s+/),d=0,e=
c.length;d<e;++d)if(!a.classList.contains(c[d]))return!1;return!0}c="string"==typeof a.className?a.className:a.getAttribute("class");return I(c,b)}function q(a,b){if("object"==typeof a.classList)for(var c=b.split(/\s+/),d=0,e=c.length;d<e;++d)a.classList.add(c[d]);else(d=(c="string"==typeof a.className)?a.className:a.getAttribute("class"))?I(d,b)||(d+=" "+b):d=b,c?a.className=d:a.setAttribute("class",d)}function v(a){return"string"==typeof a.className?a.className:a.getAttribute("class")}function m(a){return a&&
a.split(/\s+/).sort().join(" ")}function K(a,b){return m(v(a))==m(v(b))}function L(a,b){for(var c=b.split(/\s+/),d=0,e=c.length;d<e;++d)if(!J(a,c[d].replace(/^\s\s*/,"").replace(/\s\s*$/,"")))return!1;return!0}function A(a,b,c,d){-1==c&&(c=b.childNodes.length);var e=a.parentNode,f=h.getNodeIndex(a);p(d,function(a){var d=a.node,g=a.offset,M=d,h=g;d==b&&g>c&&++h;d!=e||g!=f&&g!=f+1||(M=b,h+=c-f);d==e&&g>f+1&&--h;a.node=M;a.offset=h});b.childNodes.length==c?b.appendChild(a):b.insertBefore(a,b.childNodes[c])}
function N(a,b){var c=a.parentNode,d=h.getNodeIndex(a);p(b,function(a){a.node==c&&a.offset>d&&--a.offset});h.removeNode(a)}function B(a,b){for(var c=a.parentNode,d=h.getNodeIndex(a),e,f=[];e=a.firstChild;)A(e,c,d++,b),f.push(e);N(a,b);return f}function C(a,b){var c=a.cloneRange();c.selectNodeContents(b);c=c.intersection(a);return""!=(c?c.toString():"")}function O(a){for(var b=a.getNodes([3]),c=0,d;(d=b[c])&&!C(a,d);)++c;for(var e=b.length-1;(d=b[e])&&!C(a,d);)--e;return b.slice(c,e+1)}function P(a,
b){if(a.attributes.length!=b.attributes.length)return!1;for(var c=0,d=a.attributes.length,e,f;c<d;++c)if(e=a.attributes[c],f=e.name,"class"!=f&&(f=b.attributes.getNamedItem(f),null===e!=(null===f)||e.specified!=f.specified||e.specified&&e.nodeValue!==f.nodeValue))return!1;return!0}function Q(a,b){for(var c=0,d=a.attributes.length,e;c<d;++c)if(e=a.attributes[c].name,(!b||!D(b,e))&&a.attributes[c].specified&&"class"!=e)return!0;return!1}function R(a){var b;return a&&1==a.nodeType&&((b=a.parentNode)&&
9==b.nodeType&&"on"==b.designMode||t(a)&&!t(a.parentNode))}function S(a){return(t(a)||1!=a.nodeType&&t(a.parentNode))&&!R(a)}function T(a){return a&&1==a.nodeType&&!X.test(x(a,"display"))}function Y(a){if(0==a.data.length)return!0;if(Z.test(a.data))return!1;switch(x(a.parentNode,"whiteSpace")){case "pre":case "pre-wrap":case "-moz-pre-wrap":return!1;case "pre-line":if(/[\r\n]/.test(a.data))return!1}return T(a.previousSibling)||T(a.nextSibling)}function E(a){var b=[],c,d;for(c=0;d=a[c++];)b.push(new U(d.startContainer,
d.startOffset),new U(d.endContainer,d.endOffset));return b}function F(a,b){for(var c=0,d,e,f,g=a.length;c<g;++c)d=a[c],e=b[2*c],f=b[2*c+1],d.setStartAndEnd(e.node,e.offset,f.node,f.offset)}function u(a,b,c,d){var e=0==c;if(h.isAncestorOf(b,a))return a;if(h.isCharacterDataNode(b)){var f=h.getNodeIndex(b);if(0==c)c=f;else if(c==b.length)c=f+1;else throw l.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+c+" in "+b.data);b=b.parentNode}f=b;var g=c;if(h.isCharacterDataNode(f)?
0==g?f.previousSibling:g==f.length?f.nextSibling:1:0<g&&g<f.childNodes.length){f=b.cloneNode(!1);e=b.parentNode;f.id&&f.removeAttribute("id");for(var r=0;g=b.childNodes[c];)A(g,f,r++,d);A(f,e,h.getNodeIndex(b)+1,d);return b==a?f:u(a,e,h.getNodeIndex(f),d)}return a!=b?(f=b.parentNode,b=h.getNodeIndex(b),e||b++,u(a,f,b,d)):a}function V(a){var b=a?"nextSibling":"previousSibling";return function(c,d){var e=c.parentNode,f=c[b];if(f){if(f&&3==f.nodeType)return f}else if(d){f=e[b];var g;if(g=f&&1==f.nodeType)g=
f,g=e.namespaceURI==g.namespaceURI&&e.tagName.toLowerCase()==g.tagName.toLowerCase()&&K(e,g)&&P(e,g)&&"inline"==x(e,"display")&&"inline"==x(g,"display");if(g&&(e=f[a?"firstChild":"lastChild"])&&3==e.nodeType)return e}return null}}function G(a){this.isElementMerge=1==a.nodeType;this.textNodes=[];(a=this.isElementMerge?a.lastChild:a)&&(this.textNodes[0]=a)}function w(a,b,c){var d,e,f=this;f.className=a;var g=null,r={};if("object"==typeof b&&null!==b){"undefined"!==typeof b.elementTagName&&(b.elementTagName=
b.elementTagName.toLowerCase());c=b.tagNames;g=b.elementProperties;r=b.elementAttributes;for(d=0;e=aa[d++];)b.hasOwnProperty(e)&&(f[e]=b[e]);d=b.normalize}else d=b;f.normalize="undefined"==typeof d?!0:d;f.attrExceptions=[];d=document.createElement(f.elementTagName);f.elementProperties=f.copyPropertiesToElement(g,d,!0);z(r,function(a,b){f.attrExceptions.push(a);r[a]=""+b});f.elementAttributes=r;f.elementSortedClassName=f.elementProperties.hasOwnProperty("className")?m(f.elementProperties.className+
" "+a):a;f.applyToAnyTagName=!1;a=typeof c;if("string"==a)"*"==c?f.applyToAnyTagName=!0:f.tagNames=c.toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,"").split(/\s*,\s*/);else if("object"==a&&"number"==typeof c.length)for(f.tagNames=[],d=0,a=c.length;d<a;++d)"*"==c[d]?f.applyToAnyTagName=!0:f.tagNames.push(c[d].toLowerCase());else f.tagNames=[f.elementTagName]}var h=k.dom,U=h.DomPosition,D=h.arrayContains,H=k.util,p=H.forEach,ba=H.isHostMethod(document,"createElementNS"),y=function(){function a(a,
c,d){return c&&d?" ":""}return function(b,c){if("object"==typeof b.classList)for(var d=c.split(/\s+/),e=0,f=d.length;e<f;++e)b.classList.remove(d[e]);else e=(d="string"==typeof b.className)?b.className:b.getAttribute("class"),e=e.replace(new RegExp("(^|\\s)"+c+"(\\s|$)"),a),d?b.className=e:b.setAttribute("class",e)}}(),x=h.getComputedStyleProperty,t=function(){return"boolean"==typeof document.createElement("div").isContentEditable?function(a){return a&&1==a.nodeType&&a.isContentEditable}:function(a){return a&&
1==a.nodeType&&"false"!=a.contentEditable?"true"==a.contentEditable||t(a.parentNode):!1}}(),X=/^inline(-block|-table)?$/i,Z=/[^\r\n\t\f \u200B]/,ca=V(!1),da=V(!0);G.prototype={doMerge:function(a){var b=this.textNodes,c=b[0];if(1<b.length){var d=h.getNodeIndex(c),e=[],f=0,g;p(b,function(b,k){g=b.parentNode;0<k&&(g.removeChild(b),g.hasChildNodes()||h.removeNode(g),a&&p(a,function(a){a.node==b&&(a.node=c,a.offset+=f);a.node==g&&a.offset>d&&(--a.offset,a.offset==d+1&&k<len-1&&(a.node=c,a.offset=f))}));
e[k]=b.data;f+=b.data.length});c.data=e.join("")}return c.data},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){var a=[];p(this.textNodes,function(b,c){a[c]="'"+b.data+"'"});return"[Merge("+a.join(",")+")]"}};var aa="elementTagName ignoreWhiteSpace applyToEditableOnly useExistingElements removeEmptyElements onElementCreate".split(" "),W={};w.prototype={elementTagName:"x-hl",elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,
applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,setClassName:function(a){this.className=a;this.elementSortedClassName=this.elementProperties.hasOwnProperty("className")?m(this.elementProperties.className+" "+a):a},copyPropertiesToElement:function(a,b,c){var d,e={},f,g;for(g in a)if(a.hasOwnProperty(g)){var h=a[g];var k=b[g];if("className"==g)q(b,h),q(b,this.className),b[g]=m(b[g]),c&&(e[g]=h);else if("style"==g){c&&(e[g]=f={});for(d in a[g])a[g].hasOwnProperty(d)&&
(k[d]=h[d],c&&(f[d]=k[d]));this.attrExceptions.push(g)}else b[g]=h,c&&(e[g]=b[g],h=W.hasOwnProperty(g)?W[g]:g,this.attrExceptions.push(h))}return c?e:""},copyAttributesToElement:function(a,b){for(var c in a)a.hasOwnProperty(c)&&!/^class(?:Name)?$/i.test(c)&&b.setAttribute(c,a[c])},appliesToElement:function(a){return D(this.tagNames,a.tagName.toLowerCase())},getEmptyElements:function(a){var b=this;return a.getNodes([1],function(a){return b.appliesToElement(a)&&!a.hasChildNodes()})},hasSameClassName:function(a){var b;
if(b=1==a.nodeType&&(this.applyToAnyTagName||this.appliesToElement(a)))b=this.className,b=m(v(a))==m(b);return b},getSelfOrAncestorWithClass:function(a){for(;a;){if(this.hasSameClassName(a))return a;a=a.parentNode}return null},isModifiable:function(a){return!this.applyToEditableOnly||S(a)},isIgnorableWhiteSpaceNode:function(a){return this.ignoreWhiteSpace&&a&&3==a.nodeType&&Y(a)},postApply:function(a,b,c,d){var e=a[0],f=a[a.length-1],g=[],h=e,k=f,l=0,m=f.length,q;p(a,function(a){(q=ca(a,!d))?(n||
(n=new G(q),g.push(n)),n.textNodes.push(a),a===e&&(h=n.textNodes[0],l=h.length),a===f&&(k=n.textNodes[0],m=n.getLength())):n=null});if(a=da(f,!d)){if(!n){var n=new G(f);g.push(n)}n.textNodes.push(a)}if(g.length){i=0;for(len=g.length;i<len;++i)g[i].doMerge(c);b.setStartAndEnd(h,l,k,m)}},createContainer:function(a){var b=h.getDocument(a);a=ba&&!h.isHtmlNamespace(a)&&a.namespaceURI?b.createElementNS(a.namespaceURI,this.elementTagName):b.createElement(this.elementTagName);this.copyPropertiesToElement(this.elementProperties,
a,!1);this.copyAttributesToElement(this.elementAttributes,a);q(a,this.className);if(this.onElementCreate)this.onElementCreate(a,this);return a},elementHasProperties:function(a,b){var c=this;return z(b,function(b,e){if("className"==b)return L(a,e);if("object"==typeof e){if(!c.elementHasProperties(a[b],e))return!1}else if(a[b]!==e)return!1})},elementHasAttributes:function(a,b){return z(b,function(b,d){if(a.getAttribute(b)!==d)return!1})},applyToTextNode:function(a,b){var c=a.parentNode;if(c&&1==c.nodeType&&
!/^(textarea|style|script|select|iframe)$/i.test(c.nodeName))if(c=a.parentNode,1==c.childNodes.length&&this.useExistingElements&&this.appliesToElement(c)&&this.elementHasProperties(c,this.elementProperties)&&this.elementHasAttributes(c,this.elementAttributes))q(c,this.className);else{c=a.parentNode;var d=this.createContainer(c);c.insertBefore(d,a);d.appendChild(a)}},isRemovable:function(a){return a.tagName.toLowerCase()==this.elementTagName&&m(v(a))==this.elementSortedClassName&&this.elementHasProperties(a,
this.elementProperties)&&!Q(a,this.attrExceptions)&&this.elementHasAttributes(a,this.elementAttributes)&&this.isModifiable(a)},isEmptyContainer:function(a){var b=a.childNodes.length;return 1==a.nodeType&&this.isRemovable(a)&&(0==b||1==b&&this.isEmptyContainer(a.firstChild))},removeEmptyContainers:function(a){var b=this,c=a.getNodes([1],function(a){return b.isEmptyContainer(a)});a=[a];var d=E(a);p(c,function(a){N(a,d)});F(a,d)},undoToTextNode:function(a,b,c,d){b.containsNode(c)||(a=b.cloneRange(),
a.selectNode(c),a.isPointInRange(b.endContainer,b.endOffset)&&(u(c,b.endContainer,b.endOffset,d),b.setEndAfter(c)),a.isPointInRange(b.startContainer,b.startOffset)&&(c=u(c,b.startContainer,b.startOffset,d)));this.isRemovable(c)?B(c,d):y(c,this.className)},splitAncestorWithClass:function(a,b,c){var d=this.getSelfOrAncestorWithClass(a);d&&u(d,a,b,c)},undoToAncestor:function(a,b){this.isRemovable(a)?B(a,b):y(a,this.className)},applyToRange:function(a,b){var c=this;b=b||[];var d=E(b||[]);a.splitBoundariesPreservingPositions(d);
c.removeEmptyElements&&c.removeEmptyContainers(a);var e=O(a);if(e.length){p(e,function(a){c.isIgnorableWhiteSpaceNode(a)||c.getSelfOrAncestorWithClass(a)||!c.isModifiable(a)||c.applyToTextNode(a,d)});var f=e[e.length-1];a.setStartAndEnd(e[0],0,f,f.length);c.normalize&&c.postApply(e,a,d,!1);F(b,d)}e=c.getEmptyElements(a);p(e,function(a){q(a,c.className)})},applyToRanges:function(a){for(var b=a.length;b--;)this.applyToRange(a[b],a);return a},applyToSelection:function(a){a=k.getSelection(a);a.setRanges(this.applyToRanges(a.getAllRanges()))},
undoToRange:function(a,b){var c=this;b=b||[];var d=E(b);a.splitBoundariesPreservingPositions(d);c.removeEmptyElements&&c.removeEmptyContainers(a,d);var e=O(a),f,g=e[e.length-1];if(e.length){c.splitAncestorWithClass(a.endContainer,a.endOffset,d);c.splitAncestorWithClass(a.startContainer,a.startOffset,d);for(var h=0,k=e.length;h<k;++h){var l=e[h];(f=c.getSelfOrAncestorWithClass(l))&&c.isModifiable(l)&&c.undoToAncestor(f,d)}a.setStartAndEnd(e[0],0,g,g.length);c.normalize&&c.postApply(e,a,d,!0);F(b,d)}d=
c.getEmptyElements(a);p(d,function(a){y(a,c.className)})},undoToRanges:function(a){for(var b=a.length;b--;)this.undoToRange(a[b],a);return a},undoToSelection:function(a){var b=k.getSelection(a);a=k.getSelection(a).getAllRanges();this.undoToRanges(a);b.setRanges(a)},isAppliedToRange:function(a){if(a.collapsed||""==a.toString())return!!this.getSelfOrAncestorWithClass(a.commonAncestorContainer);var b=a.getNodes([3]);if(b.length)for(var c=0,d;d=b[c++];)if(!this.isIgnorableWhiteSpaceNode(d)&&C(a,d)&&this.isModifiable(d)&&
!this.getSelfOrAncestorWithClass(d))return!1;return!0},isAppliedToRanges:function(a){var b=a.length;if(0==b)return!1;for(;b--;)if(!this.isAppliedToRange(a[b]))return!1;return!0},isAppliedToSelection:function(a){a=k.getSelection(a);return this.isAppliedToRanges(a.getAllRanges())},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)},toggleSelection:function(a){this.isAppliedToSelection(a)?this.undoToSelection(a):this.applyToSelection(a)},getElementsWithClassIntersectingRange:function(a){var b=
[],c=this;a.getNodes([3],function(a){(a=c.getSelfOrAncestorWithClass(a))&&!D(b,a)&&b.push(a)});return b},detach:function(){}};w.util={hasClass:J,addClass:q,removeClass:y,getClass:v,hasSameClasses:K,hasAllClasses:L,replaceWithOwnChildren:B,elementsHaveSameNonClassAttributes:P,elementHasNonClassAttributes:Q,splitNodeAt:u,isEditableElement:t,isEditingHost:R,isEditable:S};k.CssClassApplier=k.ClassApplier=w;k.createClassApplier=function(a,b,c){return new w(a,b,c)};k.createClassAppliers=function(a,b,c){for(var d=
{},e=0;e<a.length;e++)d[a[e]]=new w(a[e],b,c);return d};H.createAliasForDeprecatedMethod(k,"createCssClassApplier","createClassApplier",l)});return l},this);
